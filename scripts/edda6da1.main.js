if(!jQuery)throw"Missing dependency: compatible version of jQuery required";var AdventureMachine=function(a){"use strict";"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)===a});var b,c,d,e,f,g,h,i,j,k,l;return b=function(a){this.config=void 0,this.inputField=void 0,this.outputArea=void 0,this.defaultOptions={consoleContainerSelector:".am-console",inputFieldSelector:".am-console-input",outputContainerSelector:".am-console-output",messageWrapper:"<p>"},a&&this.init()},b.prototype.init=function(b){var c,d,e=this.config=a.extend({},this.defaultOptions,b),f=a(e.consoleContainerSelector),g=this;this.inputField=a(e.inputFieldSelector,f),this.outputArea=a(e.outputContainerSelector,f),this.inputField.keyup(function(b){13===b.which&&(c=a(b.currentTarget).val(),a(b.currentTarget).val(""),d=g.parse(c),a(g).trigger("onCommand",{commandText:c,commandParts:d}))})},b.prototype.display=function(b,c){var d,e;c||(c="message"),d="title"===c?a("<h1/>").html(b):"section"===c?a("<h2/>").html(b):"subsection"===c?a("<h3/>").html(b):a("<span/>").addClass(c).html(b),e=a(this.config.messageWrapper).append(d),this.outputArea.append(e),this.outputArea.scrollTop(this.outputArea[0].scrollHeight)},b.prototype.parse=function(a){this.display("> "+a);var b,c=[],d=!1,e="";for(b=0;b<a.length;b+=1)" "!==a.charAt(b)||d?'"'===a.charAt(b)?d=!d:e+=a.charAt(b):(c.push(e),e="");return e&&e.length>0&&c.push(e),c},e=function(a,b){this.game=void 0,this.shortName=a,this.description=b},e.prototype.execute=function(){throw"Cannot execute base command"},e.prototype.getDescription=function(){return this.description},e.prototype.getShortName=function(){return this.shortName},f=function(a,b,c){e.call(this,a,b),this.callback=c},f.prototype=new e,f.prototype.constructor=f,f.prototype.execute=function(){this.callback.apply(this,arguments)},d=function(a){this.name=void 0,this.availableCommands=[],this.storyCommands=[],this.console=a,this.locations={},this.currentLocation=void 0,this.availableItems=void 0,this.inventory=void 0},d.prototype.clearCommands=function(){this.availableCommands=[]},d.prototype.addCommand=function(a){this.availableCommands.push(a)},d.prototype.parseCommand=function(a,b){var c,d,f=this.availableCommands;for(d=0;d<f.length;d+=1)c=f[d],c instanceof e&&c.execute(a,b)},d.prototype.print=function(a,b){this.console.display(a,b)},d.prototype.printMessage=function(a){this.console.display(a,"message")},d.prototype.printInformation=function(a){this.console.display(a,"information")},d.prototype.printError=function(a){this.print(a,"error")},d.prototype.printGameTitle=function(a){this.print(a,"title")},d.prototype.printSectionTitle=function(a){this.print(a,"section")},d.prototype.printSubsectionTitle=function(a){this.print(a,"subsection")},d.prototype.printDescription=function(a){this.print(a,"description")},d.prototype.printCommand=function(a){this.print(a,"command")},d.prototype.addLocation=function(a){a instanceof g&&(this.locations[a.id]=a)},d.prototype.goTo=function(a){var b;if(this.locations[a]){for(this.currentLocation=this.locations[a],this.availableCommands=this.getCommands().concat(this.storyCommands).concat(this.currentLocation.getCommands()),b=0;b<this.availableCommands.length;b+=1)this.availableCommands[b].game=this;this.displayCurrentLocationInfo()}else this.printError('Error: "'+a+'" is not a valid location!')},d.prototype.displayCurrentLocationInfo=function(){var a,b,c,d,e;for(this.printSectionTitle(this.currentLocation.title),this.printDescription(this.currentLocation.description),b="Available exits:<br/>",e=!1,a=0;a<this.currentLocation.exits.length;a+=1)e=!0,b+='<span class="location">'+this.currentLocation.exits[a].exitName+"</span><br/>";if(e===!0&&this.printInformation(b),this.currentLocation.items.items){b="Items:<br/>",e=!1;for(d in this.currentLocation.items.items)this.currentLocation.items.items.hasOwnProperty(d)&&(c=this.currentLocation.items.getItem(d),c&&(e=!0,b+='<span class="location">'+c.title+"</span><br/>"));e===!0&&this.printInformation(b)}},d.prototype.newGame=function(a){var b,c,d;if(this.clearCommands(),this.name=a.name,this.npcs=a.npcs||[],this.storyCommands=a.commands||[],this.availableItems=new k(this,a.items),this.inventory=new k(this),this.addItemsToInventory(a.inventory),a.locations=a.locations||[],0===a.locations.length)throw this.printError('<span class="error">There was a problem starting this game.</span>'),'Error: Location data empty for Story "'+this.name+'"';for(b=0;b<a.locations.length;b+=1)c=a.locations[b],d=c.itemCodes,this.addItemsToLocation(c,d),this.locations[c.id]=c;this.printGameTitle(a.name),this.printInformation('Type "<span class="help">help</span>" for a list of commands'),this.goTo(a.startLocation)},d.prototype.addItemToInventory=function(a){var b=this.availableItems.getItem(a);b?this.inventory.addItem(b):this.printError('Unable to add item "'+a+'" to inventory; Item does not exist.')},d.prototype.addItemsToInventory=function(a){var b,c;if(a&&a instanceof Array)for(b=0;b<a.length;b+=1)c=a[b],this.addItemToInventory(c)},d.prototype.addItemToCurrentLocation=function(a){this.addItemsToCurrentLocation([a])},d.prototype.addItemsToCurrentLocation=function(a){this.addItemsToLocation(this.currentLocation,a)},d.prototype.addItemsToLocation=function(a,b){var c,d,e;if(!a||!a instanceof g)this.printError("Unable to add items to location; Location does not exist");else if(b&&b instanceof Array)for(c=0;c<b.length;c+=1)d=b[c],e=this.availableItems.getItem(d),e?a.addItem(e):this.printError('Unable to add item "'+d+'" to location; Item does not exist.');else this.printError("Unable to add items to location; No items defined")},d.prototype.getCommands=function(){var b=new f("go",'Go:<br/>go &lt;destination&gt; e.g. "go south"',function(a,b){var c,d,e,f=this.game.currentLocation;b&&b.length&&b.length>0&&(e=b[0],("GO"===e.toUpperCase()||"EXIT"===e.toUpperCase()||"LEAVE"===e.toUpperCase())&&(1===b.length?this.game.printInformation("Usage:<br/>"+this.getDescription()):(c=b[1],d=f.getExit(c),d?this.game.goTo(d.destinationLocationId):this.game.printError('"'+c+'" is not an exit.'))))}),c=new f("help",'help &lt;<span class="command">command</span>&gt; - help on a specific command, e.g "help go"',function(a,b){var c,d,f,g="";if(b&&b.length&&b.length>0&&"HELP"===b[0].toUpperCase())if(c=this.game.availableCommands,b.length>1)for(f=0;f<c.length;f+=1)d=c[f],d instanceof e&&d.getShortName().toUpperCase()===b[1].toUpperCase()&&this.game.printInformation(d.getDescription());else{for(g+="Help:<br/>Type one of the following commands:<br/>",f=0;f<c.length;f+=1)d=c[f],d instanceof e&&d.getShortName()!==this.getShortName()&&(g+='<span class="command">'+d.getShortName()+"</span><br/>");g+=this.getDescription()+"<br/>",this.game.printInformation(g)}}),d=new f("examine",'examine &lt;<span class="command">item</span>&gt; - examine an item, e.g "examine cupboard"',function(b,c){var d,e,f,g,h,i;if(c&&c.length&&c.length>0&&c[0].toUpperCase()===this.getShortName().toUpperCase())if(1===c.length)this.game.printInformation("Usage:<br/>"+this.getDescription());else{for(d=a.extend({},this.game.currentLocation.items.items,this.game.inventory.items),h="",g=1;g<c.length;g+=1)c[g].length>0&&(h.length>0&&(h+=" "),h+=c[g]);i=!1;for(f in d)d.hasOwnProperty(f)&&(e=d[f],e.title.toUpperCase()===h.toUpperCase()&&(i=!0,this.game.printDescription(e.description)));i||this.game.printError("Unknown item: "+h)}}),g=new f("take",'take &lt;<span class="command">item</span>&gt; - take an item, e.g "take key"',function(a,b){var c,d,e,f,g,h;if(b&&b.length&&b.length>0&&b[0].toUpperCase()===this.getShortName().toUpperCase())if(1===b.length)this.game.printInformation("Usage:<br/>"+this.getDescription());else{for(c=this.game.currentLocation.items.items,g="",f=1;f<b.length;f+=1)b[f].length>0&&(g.length>0&&(g+=" "),g+=b[f]);h=!1;for(e in c)c.hasOwnProperty(e)&&(d=c[e],d.title.toUpperCase()===g.toUpperCase()&&(h=!0,d.isCollectable()===!0?(this.game.currentLocation.items.takeItem(d.id),this.game.inventory.addItem(d),this.game.printInformation('"'+d.title+'" added to inventory.')):this.game.printError("You cannot take this item")));h||this.game.printError("Unknown item: "+g)}}),h=new f("use",'use &lt;<span class="command">item</span>&gt; - use an item, e.g "use gold key" or "use key on blue door"',function(a){var b,c,d,e,f,g,h;a&&a.trim().toUpperCase().startsWith(this.getShortName().toUpperCase())&&(b="^use[ ]+(.*)",c=b+"[ ]+on[ ]+(.*)",d=new RegExp(c,"i").exec(a),d?(e=d[1],f=d[2],g=this.game.inventory.findItemByName(f)||this.game.currentLocation.items.findItemByName(f)):(d=new RegExp(b,"i").exec(a),d&&(e=d[1])),e?(h=this.game.inventory.findItemByName(e)||this.game.currentLocation.items.findItemByName(e),h?f&&!g?this.game.printError("Can't find: \""+f+'"'):h.onUse(g):this.game.printError("Can't find: \""+e+'"')):this.game.printInformation("Usage:<br/>"+this.getDescription()))}),i=new f("inventory","inventory - display the items currently in your posession",function(a){var b,c,d,e,f;if(a&&a.trim().toUpperCase()===this.getShortName().toUpperCase()){b=this.game.inventory.items,e="Inventory:<br/>",f=!1;for(d in b)b.hasOwnProperty(d)&&(f=!0,c=b[d],e+='<span class="command">'+c.title+"</span><br/>");f||(e+="You don't have any items in your inventory yet."),this.game.printInformation(e)}}),j=new f("look","look - display information about the current location",function(a){a&&a.trim().toUpperCase()===this.getShortName().toUpperCase()&&this.game.displayCurrentLocationInfo()});return[c,b,d,g,h,i,j]},g=function(a,b,c,d){this.id=a,this.title=b,this.description=c,this.exits=[],this.itemCodes=d||[],this.items=new k},g.prototype.addExit=function(a,b){this.exits.push(new h(a,b))},g.prototype.getExit=function(a){var b,c,d;for(b=0;b<this.exits.length&&!c;b+=1)d=this.exits[b],d.exitName.toUpperCase()===a.toUpperCase()&&(c=d);return c},g.prototype.getCommands=function(){return[]},g.prototype.addItem=function(a){this.items.addItem(a)},h=function(a,b){this.exitName=a,this.destinationLocationId=b},i=function(a,b,c,d,e,f){this.id=a,this.title=b,this.description=c,this.onUseCallback=d,this.game=void 0,this.usable=void 0===e?!0:e,this.collectable=void 0===f?!0:f},i.prototype.onUse=function(){return this.onUseCallback?void this.onUseCallback.apply(this,arguments):!1},i.prototype.isCollectable=function(){return this.collectable},i.prototype.isUsable=function(){return this.usable},j=function(a,b,c,d,e){i.call(this,a,b,c,d,e,!1)},j.prototype=new i,j.prototype.constructor=j,k=function(a,b){this.game=a,this.items={},b instanceof i?this.addItem(b):b instanceof Array&&this.addItems(b)},k.prototype.addItem=function(a){a instanceof i&&(this.game&&(a.game=this.game),this.items[a.id]=a)},k.prototype.addItems=function(a){var b,c;for(b=0;b<a.length;b+=1)c=a[b],this.addItem(c)},k.prototype.getItem=function(a){return this.items[a]},k.prototype.removeItem=function(a){this.items[a]=void 0},k.prototype.takeItem=function(a){var b=this.getItem(a);return this.removeItem(a),b},k.prototype.findItemByName=function(a){var b,c;for(c in this.items)if(this.items.hasOwnProperty(c)&&(b=this.items[c],b&&b.title.toUpperCase()===a.toUpperCase()))return b;return null},l={Console:b,Game:d,Command:e,CallbackCommand:f,Location:g,Exit:h,Story:c,Item:i,Fixture:j,Inventory:k}}(jQuery);if(!jQuery)throw"Missing dependency: compatible version of jQuery required";if(!AdventureMachine)throw"Missing dependency: AdventureMachine not found";!function(a){"use strict";var b,c,d,e,f,g,h,i;b=new AdventureMachine.Console,b.init(),c=new AdventureMachine.Game(b),a(b).bind("onCommand",function(a,b){c.parseCommand(b.commandText,b.commandParts)}),i=[new AdventureMachine.Item("flashlight","Flashlight","A cracked flashlight that gives off fractured but adequate lighting.",function(a){a&&"dark-cupboard"===a.id?(this.game.printMessage("The light of the torch reveals a plastic key card, which you pick up and place in your pocket."),this.game.addItemToInventory("lift-keycard")):this.game.print("You can't use this item on "+a.title)}),new AdventureMachine.Item("lift-keycard","Keycard","An electronic keycard, presumably this used to belong to an employee working in the building, and is used to gain access to authorised areas of the office.",function(a){a&&"lift-control-panel"===a.id?(this.game.printMessage('You swipe the keycard through the control panel, which promptly makes an eletronic chirp and displays the message "Access Granted" as the lift doors slide quietly open. You enter, and press the button for the next floor.'),this.game.currentLocation.addExit("Lift","corridor-1")):this.game.print("You can't use this item on "+a.title)}),new AdventureMachine.Fixture("dark-cupboard","Dark cupboard","A service cupboard of some kind. The light is broken. In the dim light spilling into the space from the room you are standing in you can just about make out some mops and dusty shelves in the gloom, but it is too dark to see properly."),new AdventureMachine.Fixture("lift-control-panel","Lift Control Panel","Next to the lifts is a control panel, the soft blue light emitted by the LCD display giving an ethereal quality to the area. It looks like some kind of key card needs to be swiped through a card reader on the side of the panel to open the lift doors.")],d=new AdventureMachine.Location("atrium","Atrium","You are standing in the atrium of an office building. The room is deserted. You see some frosted glass doors to the south, and some lift doors illuminated by the soft blue light of a control panel on the east wall.",["flashlight","lift-control-panel"]),d.addExit("South","conferenceRoom"),e=new AdventureMachine.Location("conferenceRoom","Conference Room","You enter a conference room, and are greeted by rows of neatly-placed chairs illuminated by flickering lights. At the front of the room is a podium for the speaker. Loose papers are scattered on the floor next to the podium, gently fluttering in the wake of a lacklustre ceiling fan. Some of the chairs have been knocked over in the front row. Near the entrance is a narrow doorway, presumably leading to a service cupboard.",["dark-cupboard"]),e.addExit("North","atrium"),f=new AdventureMachine.Location("corridor-1","Upstairs Corridor",'You emerge into a corridor. Cork boards line the walls, covered with pieces of paper and notices like "Staff Christmas Party". A number of doors lead off either side of the space.'),f.addExit("Lifts","atrium"),f.addExit("Door 1","room1"),f.addExit("Door 2","room2"),g=new AdventureMachine.Location("room1","Office Space",'You spy a deserted office. One of the computers has been left on, illuminating a mug that says "You don\'t have to be mad to work here, but it sure helps!"'),g.addExit("Out","corridor-1"),h=new AdventureMachine.Location("room2","More Office Space","You spy another deserted office. Tacked to a notice board is a poster for the christmas party, with a presentation for the best costume. The party should be in full swing - where is everyone?"),h.addExit("Out","corridor-1"),c.newGame({name:"The Silence",locations:[d,e,f,g,h],startLocation:d.id,items:i,inventory:[],npcs:[],commands:[]})}(jQuery);